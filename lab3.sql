// zad.1

CREATE TABLE DOKUMENTY
    (ID NUMBER(12) PRIMARY KEY,
    DOKUMENT CLOB);
    
    
// zad.2

DECLARE
    MY_TEXT CLOB;
BEGIN
    FOR I IN 1..10000 LOOP
        MY_TEXT := MY_TEXT || 'Oto tekst. ';
    END LOOP;
    INSERT INTO DOKUMENTY VALUES(1, MY_TEXT);
END;
    
    
// zad.3

SELECT * FROM DOKUMENTY; 

SELECT UPPER(DOKUMENT)
FROM DOKUMENTY;

SELECT LENGTH(DOKUMENT)
FROM DOKUMENTY;

SELECT DBMS_LOB.GETLENGTH(DOKUMENT)
FROM DOKUMENTY;

SELECT SUBSTR(DOKUMENT, 5, 1000)
FROM DOKUMENTY;

SELECT DBMS_LOB.SUBSTR(DOKUMENT, 1000, 5)
FROM DOKUMENTY;


// zad.4

INSERT INTO DOKUMENTY VALUES(2, EMPTY_CLOB());


// zad.5

INSERT INTO DOKUMENTY VALUES(3, NULL);


// zad.6

SELECT * FROM DOKUMENTY; 

SELECT UPPER(DOKUMENT)
FROM DOKUMENTY;

SELECT LENGTH(DOKUMENT)
FROM DOKUMENTY;

SELECT DBMS_LOB.GETLENGTH(DOKUMENT)
FROM DOKUMENTY;

SELECT SUBSTR(DOKUMENT, 5, 1000)
FROM DOKUMENTY;

SELECT DBMS_LOB.SUBSTR(DOKUMENT, 1000, 5)
FROM DOKUMENTY;


// zad.7

DECLARE
    MY_BFILE BFILE;
    MY_CLOB CLOB;
    MY_WARN INTEGER;
    MY_DOFFSET INTEGER := 1;
    MY_SOFFSET INTEGER := 1;
    MY_LANGCTX INTEGER := 0;
BEGIN
    SELECT DOKUMENT INTO MY_CLOB FROM DOKUMENTY
    WHERE ID = 2
    FOR UPDATE;
    
    MY_BFILE := BFILENAME('TPD_DIR', 'dokument.txt');
    
    DBMS_LOB.OPEN(MY_BFILE, DBMS_LOB.LOB_READONLY);
    DBMS_LOB.LOADCLOBFROMFILE(MY_CLOB, MY_BFILE, DBMS_LOB.GETLENGTH(MY_BFILE), MY_DOFFSET, MY_SOFFSET, 873, MY_LANGCTX, MY_WARN); 
    DBMS_LOB.CLOSE(MY_BFILE);
    
    COMMIT;
    
    DBMS_OUTPUT.PUT_LINE('ZAKOÑCZONO OPERACJÊ KOPIOWANIA');
END;


// zad.8

UPDATE DOKUMENTY 
SET DOKUMENT = TO_CLOB(BFILENAME('TPD_DIR', 'dokument.txt'))
WHERE ID = 3;


// zad.9

SELECT * FROM DOKUMENTY;


// zad.10

SELECT DBMS_LOB.GETLENGTH(DOKUMENT)
FROM DOKUMENTY;


// zad.11

DROP TABLE DOKUMENTY;


// zad.12

CREATE OR REPLACE PROCEDURE CLOB_CENSOR (MY_CLOB IN OUT CLOB, MY_TEXT IN VARCHAR2)
AS
    MY_OFFSET NUMBER := 1;
    MY_INDEX NUMBER := 1;
    MY_LENGTH NUMBER := LENGTH(MY_TEXT);
BEGIN
    LOOP
        MY_INDEX := INSTR(MY_CLOB, MY_TEXT, MY_OFFSET);
        EXIT WHEN MY_INDEX = 0;
        DBMS_LOB.WRITE(MY_CLOB, MY_LENGTH, MY_INDEX, RPAD('.', MY_LENGTH, '.'));
        MY_OFFSET := MY_INDEX + MY_LENGTH;
    END LOOP;  
END;


// zad.13

CREATE TABLE BIOGRAPHIES AS
SELECT * FROM ZTPD. BIOGRAPHIES;

DECLARE
  MY_CLOB CLOB;
BEGIN
    SELECT BIO INTO MY_CLOB
    FROM BIOGRAPHIES 
    WHERE PERSON = 'Jara Cimrman' 
    FOR UPDATE;
    
    CLOB_CENSOR(MY_CLOB, 'Cimrman');
    
    UPDATE BIOGRAPHIES 
    SET BIO = MY_CLOB
    WHERE PERSON = 'Jara Cimrman';
    COMMIT;
END;

SELECT * FROM BIOGRAPHIES;


// zad.14
DROP TABLE BIOGRAPHIES;
